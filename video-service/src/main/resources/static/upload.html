<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上传视频</title>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"/>-->
    <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>-->

    <!-- 引入 layui.css -->
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css">
    <!-- 引入 layui.js -->
    <script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>

    <script src="//unpkg.com/axios/dist/axios.min.js"></script>

    <!--引入的自己的common.js-->
    <script src="js/common.js"></script>

    <!--阿里云oss-->
    <script src="https://gosspublic.alicdn.com/aliyun-oss-sdk-6.15.0.min.js"></script>
</head>

<body>

<form class="layui-form">

    <input type="file" id="file"/>

    <div class="layui-form-item">
        <label class="layui-form-label">Title</label>
        <div class="layui-input-block">
            <input id="input_title" type="text" name="title" lay-verify="title" autocomplete="off"
                   placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">Description</label>
        <div class="layui-input-block">
            <input id="input_description" type="text" name="description" lay-verify="required"
                   placeholder="请输入描述" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">Visibility</label>
        <div class="layui-input-block">
            <input type="radio" name="visibility" value="Public" title="Public" checked=""/>
            <input type="radio" name="visibility" value="Unlisted" title="Unlisted">
            <input type="radio" name="visibility" value="Private" title="Private">
        </div>
    </div>
</form>

<button id="btn_upload" type="button" class="layui-btn">开始上传</button>

<script>
    //首先发请求到视频微服务新建视频
    //向文件服务发请求获取阿里云对象存储令牌
    //上传阿里云对象存储
    //通知文件微服务上传完成

    // 从输入框获取file对象，例如 <input type="file" id="file" />
    const data = document.getElementById('file').files[0];

    async function putObject() {
        const client = new OSS({
            region: 'yourRegion',
            accessKeyId: 'yourAccessKeyId',
            accessKeySecret: 'yourAccessKeySecret',
            stsToken: 'yourSecurityToken',
            bucket: 'examplebucket'
        });
        const result = await client.put('exampledir/exampleobject.txt', data);
        console.log(result);
    }

    document.getElementById("btn_upload").addEventListener('click', function () {
        axios.post(APIURL + "/universal-user-service/user/login",
            {username: username, password: password})
            .then(function (response) {
                var data = response.data;
                if (data.code !== 0) {
                    //登陆失败
                    alert(data.message);
                } else {
                    //登陆成功
                    //保存loginToken
                    localStorage.setItem("loginToken", data.data.loginToken);
                    //跳转网页
                    location.href = "/loginSuccess";
                }
            });
    });

</script>

</body>
</html>